<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.554">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Response to Reviewer Comments</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="response_to_reviewers_original_submission_files/libs/clipboard/clipboard.min.js"></script>
<script src="response_to_reviewers_original_submission_files/libs/quarto-html/quarto.js"></script>
<script src="response_to_reviewers_original_submission_files/libs/quarto-html/popper.min.js"></script>
<script src="response_to_reviewers_original_submission_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="response_to_reviewers_original_submission_files/libs/quarto-html/anchor.min.js"></script>
<link href="response_to_reviewers_original_submission_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="response_to_reviewers_original_submission_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="response_to_reviewers_original_submission_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="response_to_reviewers_original_submission_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="response_to_reviewers_original_submission_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Response to Reviewer Comments</h1>
<p class="subtitle lead">MS # NCOMMS-24-29988</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><span style="color: blue">Our point-by-point response to all comments from the three reviewers is provided below. Reviewer comments are in black and our responses are in blue.</span></p>
<section id="reviewer-1" class="level3">
<h3 class="anchored" data-anchor-id="reviewer-1">Reviewer 1</h3>
<p>This is a brilliant manuscript that advances our understanding and ability to mitigate the impact of the worst disease to impact vertebrates, chytridiomycosis. The main findings are that reintroduced frogs sourced from populations of the Sierra Nevada yellow-legged frog (Rana sierrae) that are recovering from initial outbreaks and have increased resistance against chytridiomycosis are able to reestablish populations in the presence of the pathogen, Bd. The authors also investigated factors affecting reintroduction success and found that site, cohort, and frog attributes were important. They modelled the viability of reintroduced populations suggesting that many have a low probability of extinction over 50 years.</p>
<p>The work has major significance to the growing fields of chytrididomycosis, wildlife diseases, mitigation of threatening processes, conservation, reintroduction of species and related fields. The work is original and the first to demonstrate reintroduction of resistant frogs as a viable long term solution for recovering amphibian populations from the impacts of chytridiomycosis. The evidence presented supports the conclusions of the authors and the methodology is sound. The figures are excellent.</p>
<p>Some suggestions for improvement of the manuscript:</p>
<ol type="1">
<li>I appreciate the arguments made in favour of frog resistance rather than site characteristics being the reason for translocation success. Perhaps the strongest argument is that non resistant frogs were extirpated from these sites previously and would be expected to be extirpated again unless they had evolved resistance and this could be stated in the discussion.</li>
</ol>
<p><span style="color: blue">We added a sentence to the Discussion to make the point highlighted by the reviewer more strongly (lines 236-240).</span></p>
<ol start="2" type="1">
<li>The manuscript could possibly be improved by recognising that although many species have failed to evolve resistance, this may occur over a longer time frame or alternatively, species could be assisted to evolve resistance through selective breeding programs etc (Kosch et al 2022).</li>
</ol>
<p><span style="color: blue">We added additional text to the Discussion to make the point suggested by the reviewer (lines 347-351).</span></p>
<ol start="3" type="1">
<li>Similarly, the manuscript could perhaps expand on the barriers to natural recovery and spread of resistant populations and the importance of considering elevational disease gradients and connectivity when choosing reintroduction sites (Bell et al 2020).</li>
</ol>
<p><span style="color: blue">The reviewer highlights several points in this comment. We added a paragraph to the Discussion that addresses several of these points (lines 316-334; see also our response to the final “general comment” made by Reviewer 3).</span></p>
<ol start="4" type="1">
<li>Perhaps the authors could make a point in the discussion regarding the importance of sustained effort and using adaptive management techniques. This approach ensured they improved their ability to choose recipient sites with higher habitat quality and ultimately led to improved translocation success.</li>
</ol>
<p><span style="color: blue">We added additional sentences to the Discussion to make the point suggested by the reviewer (lines 345-347).</span></p>
<ol start="5" type="1">
<li>Finally, perhaps the conclusions could be a little more hopeful given the study’s results along with other current efforts at mitigating the threat of chytridiomycosis (Berger et al 2024, Waddle et al 2024).</li>
</ol>
<p><span style="color: blue">We agree with the reviewer that important progress is being made to mitigate the impacts of chytridiomycosis on the world’s amphibians. Nonetheless, many challenges remain. In writing the final paragraphs of the Discussion, we therefore didn’t want to oversell the significance of our study and that of other recent studies (as cited by the reviewer). However, we agree that the paragraph in question could provide an outlook that is a bit more hopeful. We made several changes to this paragraph to accomplish that (lines 335-355).</span></p>
<p>Congratulations to the authors on a very impressive body of work and most importantly, wonderful results for amphibian conservation. Extremely well done!</p>
<p><span style="color: blue">We appreciate the reviewer’s enthusiastic endorsement of our study.</span></p>
</section>
<section id="reviewer-2" class="level3">
<h3 class="anchored" data-anchor-id="reviewer-2">Reviewer 2</h3>
<p>This is an extremely important paper – the authors have conducted extraordinary conservation work an amphibian species known to be highly susceptible to the lethal fungal pathogen (Batrachochytrium dendrobatidis; “Bd”). Their efforts to reintroduce the Sierra Nevada yellow-legged frog (Rana sierrae) to locations where it had formally been extirpated using adults from naturally recovering populations is extremely promising. To my knowledge, this paper constitutes the largest reintroduction effort to date for an amphibian challenged by Bd, both in terms of the number of reintroductions and their subsequent success. I have few minor comments (below) and highly recommend publishing this paper. It will certainly be highly cited and serve as a model for other amphibian systems impacted by the pathogen. Additionally, I think the methods and associated data analyses are well explained and appropriate (see minor comments/suggestions below).</p>
<p>Minor comments/suggestions: (these are in no order)</p>
<p>1. Line 90-98. It seems like the sentences that discuss the three primary objectives may not be complete sentences? It seems like they might need another word: e.g., First, ‘we’ determined whether…Second, ‘we’ identified…. Etc. Maybe authors mean to provide a list. We had three primary objectives (1) determine whether…; (2) identify important site,… (3) estimate the probability of persistence…but that is a lot to include in a single sentence, so I understand (and like) breaking it apart, but I am just not sure the sentence structure is correct - note: this is an extremely minor point.</p>
<p><span style="color: blue">The sentences in question (lines 90-98) are complete sentences, and the reviewer’s suggestion to add “we” to each sentence changes the sentences from objectives to descriptions of the three components of the study. We did not make any changes in response to this comment, but we are open to any suggestions to improve the structure of these sentences.</span></p>
<p>2. The map in Figure 2 is a little hard to understand. First, the legend states that: “All populations are in Yosemite National Park (park boundary indicated by gray polygon)” – but I think the polygon is grey in the large map, but black in the inset. I would make the park boundary black in both maps. The legend also states: “In both maps, elevation is indicated by the colored hillshade layer (dark green = lowest elevation, white = highest elevation).” This is a little difficult for me to see too – there is dark green in the inset corresponding the Central Valley, but in the larger map it looks like there is green on the top of the ridges, based on the perceived topography. Maybe I’m seeing the colors incorrectly.</p>
<p><span style="color: blue">Thank you for pointing out these difficulties in interpreting the map. In the revised version of Figure 2, the polygon indicating the park boundary is now displayed in black in both the main map and the inset map. In addition, we added clarifying text to the figure legend to describe the colors and their meaning.</span></p>
<p>3. Methods and associated supplemental materials</p>
<ol type="a">
<li>Line 348-354. This explanation is confusing because of the location of the ‘(primary period)’ reference. As written, it seems like the authors are saying that a single day is the primary period - only after you read the supplemental information do you realize that they are using a site visit as the primary period. I think it’s good that the authors used the primary/secondary period terminology that is common for robust design CMR surveys, but I think it would be better and more correct to say:</li>
</ol>
<p>‘During 2006-2012, we conducted CMR surveys on a single day per site visit (primary period)…. During 2013-2022, we generally used a robust design where all habitats were searched during several consecutive days (median number….) during each visit…’</p>
<p><span style="color: blue">We updated this sentence as the reviewer suggested (lines 390-392).</span></p>
<p>In addition to the median number of secondary periods per primary period, it would also be nice to know the mean (or median) number of visits (primary periods) per summer active season during the study. At first, I thought that there was only 1 primary period per year, but the supplementary information clearly states: “Multiple primary periods can occur during a summer active season (typically July-August, but in some years as early as May and as late as September).” This would be a nice place to give the mean (or median) number of visits (primary periods) per summer active season.</p>
<p><span style="color: blue">In the reviewed version of the manuscript, we actually included the median, minimum, and maximum number of visits to each translocated population per summer active season (lines 345-346). However, it may not have been clear that a “visit” is equivalent to a “primary period”. Therefore, we added some additional text to the sentence in question to clarify this point (revised manuscript: lines 385-388).</span></p>
<ol start="2" type="a">
<li>Population viability model description.</li>
</ol>
<ul>
<li>The authors have 7 state variables which they define as ‘density’ of individuals in different life history states. Is this really density (individuals per unit area) or just the number of individuals.</li>
</ul>
<p><span style="color: blue">Good point. We are modeling abundance per population so we have replaced the word density with abundance to avoid confusion over the units of area (lines 468-472).</span></p>
<ul>
<li>Additionally, are the authors modelling both males and females, or just females. Based on the model structure it looks like they are modelling females, as there is no adjustment for the proportion of females in the population. This should be clarified. If I am correct, then shouldn’t fecundity be expressed as the number of female eggs?</li>
</ul>
<p><span style="color: blue">Thank you for the careful reading of our model. We are modeling the entire population, not just females, and are assuming a 50:50 sex ratio. This was not explicit in our equations and we have thus updated our viability model equation to explicitly include a parameter for sex ratio (<span class="math inline">\(\rho\)</span>; line 477). We also added a description of this parameter in Supplementary Table 1. While addressing this comment, we noticed that we were not consistent with modeling females vs.&nbsp;total population between the deterministic and stochastic models. We have updated the deterministic model to be exactly analogous to the stochastic model (i.e., both are now modeling total population). Our conclusions regarding viability are unchanged.</span></p>
<ul>
<li>I am also a little confused at what they consider ‘recruitment’ in this model. I understand the survival probability, indicated by sigma notation (σ), but none of the parameters listed in Supplementary Table 1 are termed recruitment. However, in both the text the term is used in multiple places, e.g., lines 106, 102, 458 and figure legends (Fig 5), but I’m sure it means different thing in these places. For this reason, I think the authors should clarify their use of the term, especially in the viability modelling. To me, recruitment is conditional on survival so I would tend to equate it with (1- 𝑝𝐽1) or the probability that given a juvenile survives it ‘recruits’ or transitions into an adult frog. I don’t think that is how the adults are using it in this model. I think they could refrain from using it at all in this section.</li>
</ul>
<p><span style="color: blue">Good question. This was a point of some discussion within our group. For a juvenile to recruit to an adult, it has to survive, and thus <span class="math inline">\(\sigma_{J_1}\)</span> encompasses survival and recruitment. This is why we used the language of “survival and recruitment” to describe this parameter in the text. However, we see how this could be confusing. Because we do not lose much biological interpretation by just referring to <span class="math inline">\(\sigma_{J_1}\)</span> as “survival” we have made this change throughout the text as suggested by the reviewer.</span></p>
<ul>
<li>Given the page limitations employed by the journal, the authors must make decisions about what information to supply. Personally, I would have liked to see a little more information on the variation in recruitment (number of new adults a population) and population growth (change in abundance over time) among recipient sites. These are estimated (line 106; Supplementary Material) but not reported from their Bayesian Jolly-Seber CMR model. Instead, the authors chose to use limited demographic estimates from reintroduced populations (adult survival only) in a population viability model to explore variation in population viability over 50 years. The only thing that varies across their 12 reintroduced populations in this exercise is adult survival; the other parameters are the same across populations (Supplementary Table 1). In essence, this exercise shows how population viability varies with adult survival. It’s really important to choose reintroduction sites where adult annual survival exceeds 0.50, preferably 0.60, and the authors make a case that survival 1-year post-translocation is a good proxy for habitat quality; however, part of that case is assuming that all other demographic parameters are the same among populations, which is probably not true. The elasticity and sensitivity analyses associated with the viability analyses do suggest that adult survival is certainly the most important parameter (almost always true in vertebrate systems). Still, the decision of what to present given limited space is up to the authors and just because it does not match what this one reviewer would have preferred does not detract from the quality and quantity of work demonstrated in this paper. This is a really good paper and definitely worthy of publication in Nature Communications.</li>
</ul>
<p><span style="color: blue">We appreciate the reviewer’s thoughtful point. It is worth noting that the viability analysis also explores variation in <span class="math inline">\(\sigma_{J_1}\)</span>, a parameter that our sensitivity analyses indicate is likely the second-most important parameter for viability following adult survival. So we are actually exploring viability across environmental conditions that affect the two most important parameters for population growth. While we agree that other vital rates likely vary to some degree across populations, we have good empirical and modeling evidence that the two parameters we explore in detail are the most important for long-term viability. The reviewer did not request any changes in response to this comment, and we did not make any.</span></p>
<ul>
<li>Lines 221-233. This is very true – congratulations!!</li>
</ul>
<p><span style="color: blue">We appreciate the reviewer’s acknowledgement and agreement with this important point of ours.</span></p>
<ul>
<li>Line 252. I suggest revising this sentence; frog survival at natal (donor) sites was never reported. If you are referring to the difference between translocated and naturally recruited adults at the 3 recipient locations (Supplementary Fig. 3) I would clarify that.</li>
</ul>
<p><span style="color: blue">As the reviewer suggested, we added a reference to Supplementary Fig. 3 in this sentence (lines 256-258).</span></p>
</section>
<section id="reviewer-3" class="level3">
<h3 class="anchored" data-anchor-id="reviewer-3">Reviewer 3</h3>
<p>General comments:</p>
<p>This is a long-term dataset, in many ways exceptionally long for in depth amphibian studies, and a valuable manuscript on a priority topic for biodiversity conservation. Bd research has been criticised for missing direct conservation applications in the field, which makes this study particularly novel and insightful, despite focusing on a single species.</p>
<p>The results are very encouraging and give much cause of cautious optimism for what has often appeared to be an almost intractable problem for amphibian conservation but while I understand the specificity of your results it would be good to have at least a paragraph that looks at the potential implications for other species and important steps forward that could be concluded from your own work.</p>
<p><span style="color: blue">We added the suggested text to one of the final paragraphs of the Discussion (lines 335-355). See also our response to Reviewer 1 - Comment 4 above.</span></p>
<p>In my opinion the text is clear and very well-written and I do not have much to add in relation to that. There is some repetition between introduction and discussion so please be aware of that.</p>
<p><span style="color: blue">We edited the Discussion to minimize any repetition between the Introduction and Discussion. Any remaining repetition reflects our interest in reinforcing points in the Discussion that were made initially in the Introduction. When specific points are repeated in both sections, we have ensured that the text differs between the two sections of the manuscript.</span></p>
<p>As a general comment, you mention that the three donor populations are large, with several hundred adults and that you have documented the genetic structure but I suggest it would be useful to briefly discuss the potential implications of the reintroductions from a genetic perspective and any potential monitoring follow-up of that aspect and mitigation strategy if required. There is a reasonable potential for creating a genetic bottleneck as a results of these reintroductions in the absence of some kind of genetic monitoring.</p>
<p><span style="color: blue">We appreciate this important point. We added text to one of the last paragraphs of the Discussion to address this issue (lines 351-355).</span></p>
<p>Also, it would be useful to briefly explain why are reintroductions important (and cost-effective) instead of simply waiting for these recovering populations to naturally expand over time.</p>
<p><span style="color: blue">This is another very important issue, and we thank the reviewer for highlighting it. We added a new paragraph to the Discussion that summarizes the inadequacy of natural recovery and the importance of translocations in allowing reestablishment of populations at the landscape scale (lines 316-334).</span></p>
<p>The methods look sound but I have limited experience in this type of multilevel Bayesian modelling.</p>
<p>Detailed comments</p>
<p>Title- Just a suggestion but for me the title would benefit from mentioning the species. Your work obviously has wider implications but remains currently very species-specific.</p>
<p><span style="color: blue">The title is currently at the recommended limit of 15 words. As such, although adding “(<em>Rana sierrae</em>)” to the title might be useful in some contexts, we opted to leave the title unchanged.</span></p>
<p>Line 155- for me this aspect of the apparent high variability linked to donor population is important and I suggest should be highlighted both in the results and especially in the discussion as a separate point. Would the reintroductions be feasible in terms of achieving long term population viability with the lowest survival based on donor population?</p>
<p><span style="color: blue">This is an important question, but we cannot address it directly using results from the current study. Our population viability analysis shows that long-term viability is significantly more likely when 1-year adult survival probability is &gt;0.5. In addition, there is strong support from the model that the lowest 1-year survival from donor population 72996 would not be sufficient for long-term viability (adult survival probability &lt; 0.5) and that the lowest 1-year adult survival from 70459 and 70567 would be sufficient for long-term viability (adult survival probability &gt; 0.5). Although it is tempting to conclude that donor populations 70459 and 70567 should be used in future translocations, our study design cannot disentangle the effects of recipient site and donor population on 1-year adult survival because these factors were not crossed (an inevitable logistical constraint when working on real landscapes and taking into account <em>R. sierrae</em> landscape genetics). We are currently conducting translocations in which frogs from several donor populations are added to a single site, and this design will allow us to separate these effects. Given our inability in the current study to estimate the independent effect of donor population on adult survival, we opted not to emphasize this issue, and instead will provide a detailed treatment of it in a subsequent paper that describes the results of the multi-donor translocations. However, we added a brief description of these multi-donor translocations to the Discussion (lines 291-297).</span></p>
<p>Line 266- I suggest more caution in this statement and perhaps combining with the following sentence, which seems a reasonable explanation but remains based on a relatively small number of sites and reintroduction events. I would strongly expect specific weather patterns to also play an important role in any given year, even if these might be rarer events that you have not yet captured.</p>
<p><span style="color: blue">We softened our assertion that 1-year frog survival is an effective proxy of longer-term survival and population viability by replacing the word “indicate” with “suggest” (lines 269-271).</span></p>
<p>Line 288- for me the value in this call for additional research warrants some brief but specific details about what that would entail. Otherwise, researchers naturally always call for additional research.</p>
<p><span style="color: blue">We replaced the text in question with a specific description of the study we are currently conducting to quantify the effects of donor population (lines 291-297; see also our response to a comment by Reviewer 3 above).</span></p>
<p>Lines 298-301- I think this is important and relevant in the wider amphibian conservation context, where juveniles at this crucial life stage are often the specifically missing dataset because they are harder to monitor. This is in many ways a failure of the sector and the opposite compared to say birds or mammals, yet has become inbuilt in much amphibian research and is worth highlighting as it has important consequences for progressing practical conservation.</p>
<p><span style="color: blue">We added a sentence to the end of this paragraph that emphasizes the critical need for better monitoring of this vulnerable life stage (lines 312-315).</span></p>
<p>Lines 310-315 I suggest you could be more forward looking here and suggest some critical steps forward for interpreting the success of your results for advancing the conservation prospects for other similarly threatened amphibian species. What are the crucial considerations that should inform their strategies and how would you go about it? It might also be useful to also briefly mention the relevance of your results for reintroductions from the perspective of captive breeding and amphibian arks given that the current approaches would not facilitate any kind of resistance building (if at all possible).</p>
<p><span style="color: blue">As described in our response to Reviewer 1 - Comment 4, we revised this paragraph to include specific recommendations for ongoing and future efforts to recover Bd-impacted amphibians. The added text addresses some of the specific points made by Reviewer 3, including mention of methods such as captive breeding and genetic inventions to facilitate the development of frog resistance against Bd infection (lines 335-355).</span></p>
<p>Line 317- why would it though? Now that you have developed a solid understanding of the process, could you not strategically reintroduce populations to facilitate ongoing natural colonisation once there are sufficient numbers to create some wider population resilience?</p>
<p><span style="color: blue">We added a paragraph to the Discussion to elaborate on the limitations of natural recovery and the need for active management via reintroductions to reestablish frogs at the landscape scale (lines 316-334). The specific scenario that the reviewer mentions is described in some detail in that paragraph (see also our response to the “general comment” from Reviewer 3 above regarding natural recovery versus recovery via reintroductions).</span></p>
<p>Line 337- this is an important methodological point and which requires a bit more substance in terms of how was absence determined, over what period, etc</p>
<p><span style="color: blue">We added a sentence to this paragraph that briefly describes the methods we used to determine <em>R. sierrae</em> absence (lines 377-379).</span></p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>